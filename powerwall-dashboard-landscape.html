<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Powerwall Landscape Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        .card { background-color: #1e293b; border-radius: 0.75rem; padding: 1.5rem; }
        .stat-value { font-size: 2.25rem; line-height: 2.5rem; font-weight: bold; }
        .stat-unit { font-size: 1.25rem; line-height: 1.75rem; color: #94a3b8; margin-left: 0.25rem;}
        .stat-label { font-size: 1rem; line-height: 1.5rem; }
        .stat-sublabel { font-size: 0.875rem; line-height: 1.25rem; color: #94a3b8; }
    </style>
</head>
<body class="p-4 md:p-6">

    <div id="app" class="max-w-screen-xl mx-auto space-y-6">
        <!-- Header & Status Banner -->
        <header>
            <div id="status-banner" class="bg-red-500 text-white p-3 rounded-lg text-center mb-4 hidden">
                <span class="font-bold" id="banner-title">HIGH USAGE</span> - <span id="banner-subtitle">Consider reducing consumption.</span>
            </div>
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold">Dashboard</h1>
                <div class="text-right">
                    <p class="text-green-400 font-semibold flex items-center gap-2"><span class="w-2 h-2 bg-green-400 rounded-full"></span>Connected</p>
                    <p class="text-sm text-slate-400">Last updated: 17:57</p>
                </div>
            </div>
        </header>

        <!-- Main Grid -->
        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
            <!-- Top Row Cards -->
            <div class="card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <p class="stat-label">Solar Production</p>
                    <i data-lucide="sun" class="w-8 h-8 text-yellow-400"></i>
                </div>
                <div>
                    <p class="stat-value">0.8<span class="stat-unit">kW</span></p>
                    <p class="stat-sublabel">Generating</p>
                </div>
            </div>
            <div class="card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <p class="stat-label">Battery</p>
                    <i data-lucide="battery-charging" class="w-8 h-8 text-green-400"></i>
                </div>
                <div>
                    <p class="stat-value">83<span class="stat-unit">%</span></p>
                    <div class="w-full bg-slate-700 rounded-full h-2 my-1">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 83%"></div>
                    </div>
                    <p class="stat-sublabel">Discharging</p>
                </div>
            </div>
            <div class="card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <p class="stat-label">Home Power</p>
                    <i data-lucide="home" class="w-8 h-8 text-blue-400"></i>
                </div>
                <div>
                    <p class="stat-value">1.5<span class="stat-unit">kW</span></p>
                    <p class="stat-sublabel">Low usage</p>
                </div>
            </div>
            <div class="card flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <p class="stat-label">Grid Status</p>
                    <i data-lucide="utility-pole" class="w-8 h-8 text-orange-400"></i>
                </div>
                <div>
                    <p class="stat-value">0<span class="stat-unit">kW</span></p>
                    <p class="stat-sublabel">Self-powered</p>
                </div>
            </div>
             <div class="card flex flex-col justify-between bg-green-900/50 border border-green-700">
                <div class="flex justify-between items-start">
                    <p class="stat-label">Self-Sufficiency</p>
                    <i data-lucide="leaf" class="w-8 h-8 text-green-400"></i>
                </div>
                <div>
                    <p class="stat-value">69<span class="stat-unit">%</span></p>
                    <p class="stat-sublabel">Good for today</p>
                </div>
            </div>

            <!-- Bottom Row Cards -->
            <div class="card lg:col-span-2">
                <p class="stat-label mb-4">Current Weather (Wigston, UK)</p>
                <div class="flex items-center gap-6">
                    <i data-lucide="cloud-sun" class="w-20 h-20 text-yellow-400"></i>
                    <div>
                        <p class="text-5xl font-bold">19¬∞C</p>
                        <p class="text-slate-300">Overcast</p>
                    </div>
                    <div class="text-slate-300">
                        <p>Wind: 15 km/h SE</p>
                        <p>Conditions: Day</p>
                    </div>
                </div>
            </div>
            <div class="card lg:col-span-2">
                <p class="stat-label mb-4">Energy Today</p>
                 <div class="grid grid-cols-2 gap-x-6 gap-y-2 text-slate-300">
                    <div class="flex justify-between items-center"><span>‚òÄÔ∏è Solar Generated</span> <span class="font-bold text-white">32.1 kWh</span></div>
                    <div class="flex justify-between items-center"><span>üè† Home Consumed</span> <span class="font-bold text-white">27.1 kWh</span></div>
                    <div class="flex justify-between items-center"><span>üîã Battery Charged</span> <span class="font-bold text-white">15.5 kWh</span></div>
                    <div class="flex justify-between items-center"><span>‚ö°Ô∏è Grid Export</span> <span class="font-bold text-white">6.3 kWh</span></div>
                </div>
            </div>
             <div class="card">
                <p class="stat-label mb-4">Today's Forecast</p>
                <div class="flex items-center gap-4">
                     <i data-lucide="sun" class="w-12 h-12 text-yellow-400"></i>
                     <div>
                        <p class="text-2xl font-bold">16¬∞C</p>
                        <p class="text-slate-300">Clear</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Chart and Details Section -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="card lg:col-span-3">
                 <div class="flex justify-between items-center mb-4">
                     <h2 class="text-xl font-semibold">Today's Power Flow</h2>
                     <button class="bg-sky-600 hover:bg-sky-700 text-sm px-4 py-2 rounded-lg font-semibold">View Panel Details</button>
                 </div>
                 <canvas id="todayChart" height="100"></canvas>
            </div>
        </section>
        
        <!-- Hidden Modal for API Keys -->
        <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden">
             <!-- To be implemented in Stage 1 -->
        </div>

    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // --- Mockup Logic for Status Banner ---
            function updateStatusBanner(homeUsageKw) {
                const banner = document.getElementById('status-banner');
                if (homeUsageKw > 3.0) { // Example threshold
                    banner.classList.remove('hidden', 'bg-yellow-500');
                    banner.classList.add('bg-red-500');
                    document.getElementById('banner-title').textContent = 'HIGH USAGE';
                    document.getElementById('banner-subtitle').textContent = 'Consider reducing consumption.';
                } else {
                    banner.classList.add('hidden');
                }
            }
            updateStatusBanner(1.5); // Initial check with mockup data

            // --- "Today's Power" Chart Logic (Mock Data) ---
            const todayCtx = document.getElementById('todayChart').getContext('2d');
            const todayChart = new Chart(todayCtx, {
                type: 'line',
                data: { labels: [], datasets: [
                    { label: 'Solar (kW)', data: [], borderColor: '#facc15', yAxisID: 'yPower', tension: 0.3, borderWidth: 2.5, pointRadius: 0, fill: true, backgroundColor: '#facc1520' },
                    { label: 'Home (kW)', data: [], borderColor: '#60a5fa', yAxisID: 'yPower', tension: 0.3, borderWidth: 2.5, pointRadius: 0 },
                    { label: 'Battery (%)', data: [], borderColor: '#4ade80', yAxisID: 'yPercent', tension: 0.3, borderWidth: 2.5, pointRadius: 0 }
                ]},
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: { type: 'time', time: { unit: 'hour' }, ticks: { color: '#94a3b8' }, grid: { display: false } },
                        yPower: { position: 'left', ticks: { color: '#94a3b8', callback: (value) => `${value} kW` }, grid: { color: 'rgba(100, 116, 139, 0.2)' } },
                        yPercent: { position: 'right', min: 0, max: 100, ticks: { color: '#94a3b8', callback: (value) => `${value}%` }, grid: { display: false } }
                    },
                    plugins: { legend: { labels: { color: '#cbd5e1' } } }
                }
            });

            // Mock data for chart
            const now = new Date();
            now.setHours(17, 57, 0, 0); 
            const midnight = new Date(now).setHours(0, 0, 0, 0);
            for (let time = midnight; time <= now; time += 15 * 60 * 1000) {
                const hour = new Date(time).getHours();
                let solar = Math.pow(Math.sin((hour - 5) / 15 * Math.PI), 2) * 5;
                let home = 0.5 + Math.sin(hour * 2) * 0.5 + Math.random();
                let battery = 10 + (hour-6)*9;
                battery = Math.max(10, Math.min(100, battery));

                todayChart.data.labels.push(time);
                todayChart.data.datasets[0].data.push(solar.toFixed(2));
                todayChart.data.datasets[1].data.push(home.toFixed(2));
                todayChart.data.datasets[2].data.push(battery);
            }
            todayChart.update();
        });
    </script>
</body>
</html>

